<html>
	<head>
		<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Droid+Sans+Mono">
		<style>body{font: 'Droid Sans Mono', sans-serif;}</style>
		<link rel='stylesheet' href="a.css">
		<script src="bower_components/platform/platform.js"></script>
		<link rel="import" href="elements/user-card-list.html">
		<link rel="import" href="elements/video-card-list.html">
		<link rel="import" href="elements/voice-tube.html">
		<link rel="import" href="elements/user-status.html">
		<script src="elements/jquery-2.1.1.min.js"></script>
		<script src="https://cdn.firebase.com/js/client/1.1.3/firebase.js"></script>
		<script src="jsUtils.js"></script>
		<script src="main.js"></script>
	</head>
	<body class='fontstyle'>
		
		<div id='cards' vertical layout center-justified>
			<user-card-list id='uclist'></user-card-list>
			<br>
			<c3-timeseries id='c3t' width='60%'></c3-timeseries>
		</div>

		<div id='videos' style='text-align:center; position: relative;top: 30%;transform: translateY(-50%);'>
			<div style='height:350px'></div>
			<video-card-list id='vclist'></video-card-list>
		</div>

		<div id='selectRange' style='margin:0 auto;'>
			<user-status id='userStatus' style="font-size:1.2em;"></user-status>
			<div layout horizontal style='font-size:2em;width:600px;margin-top:50px' center>
		      <div>
		      <input id='srange' value='1' style='width:150px;text-align:center;font-size:2em'>
		      </div>
		      <div flex style='text-align:center'>~</div>
		      <div>
		      <input id='erange' value='70' style='width:150px;text-align:center;font-size:2em'>
		      </div>
		    </div>
		    <div style='width:600px;text-align:center'>
		    	<button id='go' style='width:80%;height:100px;font-size:4em;margin:100px auto'>Go</button>
		   	</div>
		</div>

		<div id='showtime'>
			<div id='board' style="display:none;position:absolute;right:0">
				<div vertical layout end style="color:#faa;font: 120px/1.3 'Crafty Girls';height:200px;">
				<div id='score' style="width:300px;text-align:center"></div>
				<div style="width:300px;text-align:center;margin:-60px 0 0 0">=</div>
				</div>
			</div>
			<div id='ctx' style='margin:0 100px 0 100px'></div>
			<div style='font-size:0.5em'>
				<div id='sc'></div>
				<div id='result'></div>
				<div id='speak'></div>
			</div>
		</div>

		<script>
		function showUserChart(username){
			var info = window[username].studyHistory();
			var columns = [[],['time(min)'],['sentence']]
			for(var key in info){
				columns[0].push(key);
				var min = parseInt(info[key].spendTime/60);
				columns[1].push(min);
				columns[2].push(info[key].sentenceAmt);
			}
			c3t.render(columns);
		}

		//window.onbeforeunload = function() { return "You work will be lost."; };
		//c3t.columns = '[["2013/01/01", "2013/01/02"],["data1", 30, 200],["data2", 310, 100]]'
			var range = localStorage.getItem('selectRange');
			if(range!=null){
				range = JSON.parse(range);
				srange.value = range.start;
				erange.value = range.end;
			}

			go.addEventListener('click',function(e){
				var range = {
					start: srange.value,
					end: erange.value
				};
				localStorage.setItem('selectRange',JSON.stringify(range));
				$('#selectRange').fadeOut(function(){
					insertVoiceTube(study.vid,study.youtubeid,range.start+'..'+range.end);
					$('#showtime').fadeIn();
				});
			});

			addEventListener('user-card-click',function(e){
				study.username = e.detail;
				$('#cards').fadeOut(function(){
					$('#videos').fadeIn();
				});
			});

			addEventListener('user-card-onHovered',function(e){
				var username = e.detail;
				showUserChart(username);
			});

			addEventListener('video-card-click',function(e){
				var username = study.username;
				study = e.detail;
				study.username = username;
				$('#videos').fadeOut(function(){
					$('#selectRange').fadeIn();
					var info = uclist.info();
					var user = new User(username,info[username]);
					info = user.videoInfo(study);
					userStatus.info(info);
					userStatus.renderChart(user);				
				});
			});

			addEventListener('x-sentence-completed',function(e){
				updateSentence(e.detail.val);
			});

			addEventListener('voice-tube-ready',function(e){
				v.focus();
			});

			addEventListener('voice-tube-completed',function(e){
				var i = e.detail;
				board.style.display = 'block';
				document.querySelector('#score').innerHTML = i.score;
				document.querySelector('#sc').innerHTML = i.score;
				document.querySelector('#result').innerHTML = '花費時間:' + i.spendTime;
				document.querySelector('#speak').innerHTML = '聆聽次數:' + i.speakTimes;
			});
		</script>
	</body>
</html>

